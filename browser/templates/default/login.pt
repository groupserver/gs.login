<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  tal:define="state view/processCredentials;
  site context/Scripts/get/division_object;
  siteName python:view.siteInfo.get_name();
  siteId python:view.siteInfo.get_id()">
  <tal:block metal:use-macro="context/@@groupserver_site_home_layout/page">
    <head>
      <title metal:fill-slot="title">
        <span tal:replace="siteName"/>: Login
      </title>
      
      <tal:block metal:fill-slot="metadata">
        <meta name="title" content="GroupServer Login"/>
        <meta name="author" content="Richard Waid" />
        <meta name="description" content="This page is used to login to GroupServer" />
        <meta name="date" content="2007-01-29"/>
      </tal:block>
      
    <tal:block metal:fill-slot="javascript">
        <script type="text/javascript" 
          src="/++resource++crypto/sha1.js">&#160;</script>
        <script type="text/javascript"
          src="/++resource++popup_help-20071218.js">&#160;</script>
        <script type="text/javascript"
          src="/++resource++check_required-20071214.js">&#160;</script>
        <script type="text/javascript">
          jQuery.noConflict();
          function loginSubmit(event) {
              var el = jQuery('#login-form');
              var pw = jQuery('#password').val();
              var encrypt = jQuery('#ep').val();
              if (encrypt == 'True') {
                  pw = b64_sha1(pw);
              }
              var loginText = jQuery('#login').val();
              var seed = jQuery('#seed').val();
              var new_passvalue = hex_hmac_sha1(pw, (loginText+pw+seed));
              jQuery('#ph').val(new_passvalue);
              jQuery('#password').val('');
              //Event.unloadCache();
          };
          function setupLogin(event) {
              jQuery('#login-form').submit(loginSubmit);
          }
          jQuery(document).ready(setupLogin);
          jQuery.noConflict()
          jQuery(document).ready( function () {
              GSPopupFormHelp.init('#login-form');
              GSCheckRequired.init(['#login', '#password'], '#loginButton');
          });
          jQuery('#login').focus();
        </script>
      </tal:block>

      </head>
    <body>
      <div metal:fill-slot="messages" tal:omit-tag="">
        <div class="message-error"
        tal:condition="python:view.state and not view.state[0]">
        <p>Please enter your email address and password below.</p>
        <p>This is usually neccessary for one of these reasons:</p>
        <ul>
          <li>you attempted to login, but either your email address or
            your password was incorrect</li>
          
          <li>you tried to access a link inside the restricted area,
            but you haven't yet logged in (this could have happened if
            you clicked on a link in an email, for instance)</li>
          
          <li>your browser does not have cookies enabled</li>
        </ul>
        </div>
      </div>

      <div metal:fill-slot="contextnavigation" />
      <div metal:fill-slot="breadcrumb" />
      
      <tal:block metal:fill-slot="body">
        <tal:block condition="view/anonomous_viewing_page">
          <h1>Login</h1>
          <form id="login-form" tal:attributes="action request/URL">
            <input type="hidden" id="seed" name="seed" tal:attributes="value view/generateSeed"/>
            <input type="hidden" id="ep" name="ep" tal:attributes="value view/passwordsEncrypted"/>
            <input type="hidden" id="ph" name="ph" value=""/>
            <input type="hidden" id="came_from" name="came_from" tal:attributes="value request/came_from | nothing" />
            <input type="hidden" id="failed" name="failed" tal:attributes="value python:view.state and not view.state[0]"/>
            
            <div class="form-widget required">
              <label class="text" 
                title="Enter the email address, or login name, you use with your forums on this site"
                for="login">Email Address</label>
              <input id="login"  name="login" class="text" type="text" 
                value="" title="Enter your email address here" />
            </div>
              
            <div class="form-widget required">
              <label class="text" 
                title="Enter the password that you use with this site (case-sensitive)"
                for="password">Password</label>
              <input id="password" class="text" 
                type="password" name="password" 
                value="" title="Enter your password"/>
            </div>
            
            <div class="form-widget not-required">
              <input type="checkbox" title="Remember me" 
                class="checkboxType" value="1" 
                name="__ac_persistent" id="__ac_persistent" />
              <label for="__ac_persistent" class="checkboxLabel"
                title="Check this if you want to automatically log in next time you visit this site from this computer. Do not check this if you are using a public terminal!">Remember me</label>
            </div>

            <div class="buttons">
              <div class="formelementbutton">
                <input class="button" type="submit" name="submit" 
                  id="loginButton"
                  value="Login" />
              </div>
            </div>
          </form>
        <dl>
          <dt>Can't log in?</dt>
          <dd>
            <a href="/reset_password.html">Reset your 
              <strong>password</strong></a>
          </dd>
          <dt>Sign up</dt>
          <dd>
            <a href="/request_registration.html"><strong>Sign 
                up</strong></a> 
            and join the groups on
            <span class="site" 
              tal:content="view/siteInfo/get_name">this site</span></dd>
          <dt>Help</dt>
          <dd>
            Check the
            <a href="/help/faqs"><strong>frequently asked
              questions</strong></a>
          </dd>
        </dl>
        </tal:block><!--AnonView-->
        <tal:block condition="not:view/anonomous_viewing_page">
          <tal:block condition="view/logged_in_user_viewing_login">
            <h1>You are Already Logged In</h1>
            <p>
              You cannot login, because you are already logged in!
              Go to 
              <a href="/">the homepage for
                <span class="site" 
                  tal:content="view/siteInfo/get_name">this site</span></a>
              to view the messages in your groups.</p>
          </tal:block><!--logged_in_user_viewing_login-->
          <tal:block condition="not:view/logged_in_user_viewing_login">
            <h1>Permission Denied</h1>
            <p tal:define="url python:request.form.get('came_from', '')">
              You do not have permission to see the page you tried to view:
              <a tal:attributes="href url"
                href="#"><code class="url" tal:content="url">#</code>.</a>
              If you think you should have permission to view this page,
              <a tal:attributes="href python:'mailto:%s?Subject=Permission Denied: %s' %(view.siteInfo.get_support_email(), url)" 
                href="#">contact support.</a>
            </p>
          </tal:block><!--not:logged_in_user_viewing_login-->
        </tal:block><!--not:view/anonomous_viewing_page-->
      </tal:block><!--body-->
    </body>
  </tal:block>
</html>

