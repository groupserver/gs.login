<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  tal:define="state view/processCredentials">

  <tal:block metal:use-macro="context/@@groupserver_layout/page">

  <head>
    
    <title metal:fill-slot="title">Login</title>
        
    <tal:block metal:fill-slot="metadata">
      <meta name="title" content="GroupServer Login"/>
      <meta name="author" content="Richard Waid" />
      <meta name="description" content="This page is used to login to GroupServer" />
      <meta name="date" content="2007-01-29"/>
    </tal:block>

    <tal:block metal:fill-slot="javascript">
      <script type="text/javascript" src="/++resource++prototype/prototype.js">&#160;</script>
      <script type="text/javascript" src="/++resource++scriptaculous/scriptaculous.js?load=effects">&#160;</script>
      <script type="text/javascript" src="/++resource++crypto/sha1.js">&#160;</script>
      <script type="text/javascript">
          function loginSubmit(event) {
              el = Event.element(event);
              
              pw = $F(el.password);
              if ($F(el.ep) == 'True') {
                  pw = b64_sha1(pw);
              }

              new_passvalue = hex_hmac_sha1(pw, ($F(el.login)+pw+$F(el.seed)));
              el.ph.value = new_passvalue;
              el.password.value = '';
              Event.unloadCache();
          };
          function onload(event) {
              if ($F($('login').failed) == 'True') {
                  // shake the login box for a little extra feedback,
                  // and 'cause it looks cool ;)
                  Effect.Shake($('login'));
              }
              Event.observe($('login'), 'submit', loginSubmit);
          }
          Event.observe(window, 'load', onload);
      </script>
    </tal:block>

  </head>
  
  <body>

    <div metal:fill-slot="messages" class="message-error"
      tal:condition="python:view.state and not view.state[0]">
      <p>Please enter your login name and password, below.</p>
      <p>This is usually neccessary for one of these reasons:</p>      
      <ul>
         <li>you attempted to login, but either your login name, or
             your password were incorrect</li>
         
         <li>you have tried to access a link inside the restricted area,
             but you haven't yet logged in (this could have happened if
             you clicked on a link in an email for instance)</li>
         
         <li>your browser does not have cookies enabled</li>
      </ul>
    </div>

    <div metal:fill-slot="contextnavigation" />

    <tal:block metal:fill-slot="body">
          <form id="login">
              <input type="hidden" name="seed" tal:attributes="value view/generateSeed"/>
              <input type="hidden" name="ep" tal:attributes="value view/passwordsEncrypted"/>
              <input type="hidden" name="ph" value=""/>
              <input type="hidden" name="came_from" tal:attributes="value request/came_from | nothing" />
              <input type="hidden" name="failed" tal:attributes="value python:view.state and view.state[0]"/>
              <div class="formelementtext">
                  <label class="text" for="login">Login name</label>
                  <div class="hint">Enter your login name</div>
                  <input id="login" class="text" type="text" value="" title="Enter your login name" name="login" />
              </div>
              <div class="formelementtext">
                  <label class="text" for="password">Login password</label>
                  <div class="hint">Enter your password</div>
                  <input id="password" class="text" type="password" value="" title="Enter your password" name="password" />
              </div>
              <div class="formelementsinglecheck">
                  <label for="__ac_persistent" class="singlecheck">Remember me</label>
                  <div class="checkgroup">
                      <input type="checkbox" title="Remember me" name="__ac_persistent" id="__ac_persistent" value="1" />
                  </div>
              </div>
              <div class="formelementbutton">
                  <input class="text" type="submit" name="submit" value="login" />
              </div>
          </form>
    </tal:block>
  </body>
  </tal:block>
</html>
